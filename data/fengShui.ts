import type { FengShuiItem, FengShuiOption } from "~/types/fengshui";

export const fengShuiItems: FengShuiItem[] = [
  {
    id: "1",
    title: "fengShuiItems.1.title",
    info: "fengShuiItems.1.info",
    options: [
      {
        id: "1_1",
        label: "fengShuiItems.1.options.1.label",
        description: "fengShuiItems.1.options.1.description",
        score: 3,
      },
      {
        id: "1_2",
        label: "fengShuiItems.1.options.2.label",
        description: "fengShuiItems.1.options.2.description",
        score: 3,
      },
      {
        id: "1_3",
        label: "fengShuiItems.1.options.3.label",
        description: "fengShuiItems.1.options.3.description",
        score: 3,
      },
      {
        id: "1_4",
        label: "fengShuiItems.1.options.4.label",
        description: "fengShuiItems.1.options.4.description",
        score: 3,
      },
    ],
  },
  {
    id: "2",
    title: "fengShuiItems.2.title",
    info: "fengShuiItems.2.info",
    options: [
      {
        id: "2_1",
        label: "fengShuiItems.2.options.1.label",
        description: "fengShuiItems.2.options.1.description",
        score: -3,
      },
      {
        id: "2_2",
        label: "fengShuiItems.2.options.2.label",
        description: "fengShuiItems.2.options.2.description",
        score: -3,
      },
      {
        id: "2_3",
        label: "fengShuiItems.2.options.3.label",
        description: "fengShuiItems.2.options.3.description",
        score: -3,
      },
      {
        id: "2_4",
        label: "fengShuiItems.2.options.4.label",
        description: "fengShuiItems.2.options.4.description",
        score: -3,
      },
      {
        id: "2_5",
        label: "fengShuiItems.2.options.5.label",
        description: "fengShuiItems.2.options.5.description",
        score: -3,
      },
      {
        id: "2_6",
        label: "fengShuiItems.2.options.6.label",
        description: "fengShuiItems.2.options.6.description",
        score: -3,
      },
    ],
  },
  {
    id: "3",
    title: "fengShuiItems.3.title",
    info: "fengShuiItems.3.info",
    options: [
      {
        id: "3_1",
        label: "fengShuiItems.3.options.1.label",
        description: "fengShuiItems.3.options.1.description",
        score: -3,
      },
      {
        id: "3_2",
        label: "fengShuiItems.3.options.2.label",
        description: "fengShuiItems.3.options.2.description",
        score: 3,
      },
    ],
  },
  {
    id: "4",
    title: "fengShuiItems.4.title",
    info: "fengShuiItems.4.info",
    options: [
      {
        id: "4_1",
        label: "fengShuiItems.4.options.1.label",
        description: "fengShuiItems.4.options.1.description",
        score: 2,
      },
      {
        id: "4_2",
        label: "fengShuiItems.4.options.2.label",
        description: "fengShuiItems.4.options.2.description",
        score: 2,
      },
      {
        id: "4_3",
        label: "fengShuiItems.4.options.3.label",
        description: "fengShuiItems.4.options.3.description",
        score: 2,
      },
      {
        id: "4_4",
        label: "fengShuiItems.4.options.4.label",
        description: "fengShuiItems.4.options.4.description",
        score: 2,
      },
    ],
  },
  {
    id: "5",
    title: "fengShuiItems.5.title",
    info: "fengShuiItems.5.info",
    options: [
      {
        id: "5_1",
        label: "fengShuiItems.5.options.1.label",
        description: "fengShuiItems.5.options.1.description",
        score: 2,
      },
      {
        id: "5_2",
        label: "fengShuiItems.5.options.2.label",
        description: "fengShuiItems.5.options.2.description",
        score: 2,
      },
    ],
  },
  {
    id: "6",
    title: "fengShuiItems.6.title",
    info: "fengShuiItems.6.info",
    options: [
      {
        id: "6_1",
        label: "fengShuiItems.6.options.1.label",
        description: "fengShuiItems.6.options.1.description",
        score: 2,
      },
      {
        id: "6_2",
        label: "fengShuiItems.6.options.2.label",
        description: "fengShuiItems.6.options.2.description",
        score: 2,
      },
    ],
  },
  {
    id: "7",
    title: "fengShuiItems.7.title",
    info: "fengShuiItems.7.info",
    options: [
      {
        id: "7_1",
        label: "fengShuiItems.7.options.1.label",
        description: "fengShuiItems.7.options.1.description",
        score: 2,
      },
      {
        id: "7_2",
        label: "fengShuiItems.7.options.2.label",
        description: "fengShuiItems.7.options.2.description",
        score: 2,
      },
      {
        id: "7_3",
        label: "fengShuiItems.7.options.3.label",
        description: "fengShuiItems.7.options.3.description",
        score: 2,
      },
    ],
  },
  {
    id: "8",
    title: "fengShuiItems.8.title",
    info: "fengShuiItems.8.info",
    options: [
      {
        id: "8_1",
        label: "fengShuiItems.8.options.1.label",
        description: "fengShuiItems.8.options.1.description",
        score: 2,
      },
      {
        id: "8_2",
        label: "fengShuiItems.8.options.2.label",
        description: "fengShuiItems.8.options.2.description",
        score: 2,
      },
      {
        id: "8_3",
        label: "fengShuiItems.8.options.3.label",
        description: "fengShuiItems.8.options.3.description",
        score: 2,
      },
      {
        id: "8_4",
        label: "fengShuiItems.8.options.4.label",
        description: "fengShuiItems.8.options.4.description",
        score: 2,
      },
    ],
  },
] as const;

export const optionsMap: Map<string, FengShuiOption> = new Map();
fengShuiItems.forEach((item) => {
  item.options.forEach((option) => {
    optionsMap.set(option.id, option);
  });
});

// Calculate theoretical min and max scores based on available options
let minPossible = 0;
let maxPossible = 0;

fengShuiItems.forEach((item) => {
  item.options.forEach((option) => {
    if (option.score < 0) {
      minPossible += option.score;
    } else if (option.score > 0) {
      maxPossible += option.score;
    }
  });
});

export const calculateScore = (selectedOptions: FengShuiOption[]): number => {
  if (selectedOptions.length === 0) return 50; // Neutral score when nothing selected

  // Calculate raw score
  let rawScore = 0;
  selectedOptions.forEach((option) => {
    rawScore += option.score;
  });

  // Linear normalization: map [minPossible, maxPossible] to [0, 100]
  // Formula: score = ((rawScore - min) / (max - min)) * 100
  let normalizedScore: number;

  if (rawScore >= 0) {
    // Positive scores: map [0, maxPossible] to [50, 100]
    normalizedScore = 50 + (rawScore / maxPossible) * 50;
  } else {
    // Negative scores: map [minPossible, 0] to [0, 50]
    normalizedScore = 50 + (rawScore / Math.abs(minPossible)) * 50;
  }

  // Clamp to [0, 100] range
  normalizedScore = Math.max(0, Math.min(100, normalizedScore));

  return parseFloat(normalizedScore.toFixed(2));
};
